<form id="intakeForm" novalidate>
  <input type="hidden" name="siteKey" id="siteKey" value="WL5616!SecureKey" />
  <!-- Honeypot: keep hidden via CSS; never remove name="company" -->
  <div style="position:absolute; left:-9999px; top:-9999px; height:0; overflow:hidden;">
    <label>Company <input type="text" name="company" autocomplete="organization" tabindex="-1"></label>
  </div>

  <label>First name
    <input id="first-name" name="first-name" autocomplete="given-name" required>
  </label>

  <label>Last name
    <input id="last-name" name="last-name" autocomplete="family-name" required>
  </label>

  <label>Email
    <input id="email" name="email" type="email" autocomplete="email" required>
  </label>

  <label>Phone
    <input id="phone" name="phone" type="tel" autocomplete="tel">
  </label>

  <label>Street
    <input id="street" name="street" autocomplete="street-address">
  </label>

  <label>City
    <input id="city" name="city" autocomplete="address-level2">
  </label>

  <label>State
    <select id="state" name="state" autocomplete="address-level1">
      <option value="">Select…</option>
      <option>AL</option><option>AK</option><option>AZ</option><option>AR</option>
      <option>CA</option><option>CO</option><option>CT</option><option>DE</option>
      <option>FL</option><option>GA</option><option>HI</option><option>ID</option>
      <option>IL</option><option>IN</option><option>IA</option><option>KS</option>
      <option>KY</option><option>LA</option><option>ME</option><option>MD</option>
      <option>MA</option><option>MI</option><option>MN</option><option>MS</option>
      <option>MO</option><option>MT</option><option>NE</option><option>NV</option>
      <option>NH</option><option>NJ</option><option>NM</option><option>NY</option>
      <option>NC</option><option>ND</option><option>OH</option><option>OK</option>
      <option>OR</option><option>PA</option><option>RI</option><option>SC</option>
      <option>SD</option><option>TN</option><option>TX</option><option>UT</option>
      <option>VT</option><option>VA</option><option>WA</option><option>WV</option>
      <option>WI</option><option>WY</option>
    </select>
  </label>

  <label>ZIP
    <input id="zip" name="zip" inputmode="numeric" autocomplete="postal-code">
  </label>

  <label>Interest
    <select id="interest" name="interest">
      <option value="">Select…</option>
      <option value="guardianship">Guardianship</option>
      <option value="ltc">LTC</option>
      <option value="estate">Estate</option>
      <option value="probate">Probate</option>
      <option value="other">Other</option>
    </select>
  </label>

  <label>Message
    <textarea id="message" name="message" rows="5"></textarea>
  </label>

  <button id="submitBtn" type="submit">Send</button>
  <div id="status" aria-live="polite" style="margin-top:.5rem;"></div>
</form>

<script>
const FLOW_URL = "https://prod-121.westus.logic.azure.com:443/workflows/2fd109379c324cd5bbab1546b34dca3c/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=GH5F3oVR83EzQ2fzn0l0yUzqs9bmVpHFZP0D0lJgBV8"; // set after you build the Flow

document.getElementById('intakeForm').addEventListener('submit', submitIntake);

function digitsOnly(s) {
  return (s || '').replace(/[^\d]/g, '');
}

// optional: trim a US leading “1”
function trimLeadingOne(digs) {
  return (digs.length === 11 && digs.startsWith('1')) ? digs.slice(1) : digs;
}

async function submitIntake(e) {
  e.preventDefault();
  const form = e.target;
  const btn = document.getElementById('submitBtn');
  const status = document.getElementById('status');

  btn.disabled = true;
  status.textContent = 'Sending…';

  // collect + normalize
  const data = {
    siteKey: document.getElementById('siteKey').value || '',
    company: form.elements['company']?.value || '', // honeypot
    "first-name": form.elements['first-name'].value.trim(),
    "last-name": form.elements['last-name'].value.trim(),
    email: form.elements['email'].value.trim(),
    phone: trimLeadingOne(digitsOnly(form.elements['phone'].value)),
    street: form.elements['street'].value.trim(),
    city: form.elements['city'].value.trim(),
    state: form.elements['state'].value.trim(),
    zip: form.elements['zip'].value.trim(),
    interest: form.elements['interest'].value.trim(),
    message: form.elements['message'].value.trim()
  };

  try {
    const res = await fetch(FLOW_URL, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(data),
      mode: 'cors',
      credentials: 'omit'
    });

    const ok = res.ok;
    let payload = null;
    try { payload = await res.json(); } catch {}
    if (ok && payload?.success) {
      status.textContent = 'Thanks — your message has been sent.';
      form.reset();
    } else {
      status.textContent = (payload?.message) ? `Error: ${payload.message}` : 'Something went wrong.';
    }
  } catch (err) {
    status.textContent = 'Network error. Please try again.';
  } finally {
    btn.disabled = false;
  }
}
</script>
